"use strict";var D=Object.create;var p=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var J=(e,t)=>{for(var n in t)p(e,n,{get:t[n],enumerable:!0})},b=(e,t,n,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of O(t))!$.call(e,r)&&r!==n&&p(e,r,{get:()=>t[r],enumerable:!(c=B(t,r))||c.enumerable});return e};var N=(e,t,n)=>(n=e!=null?D(R(e)):{},b(t||!e||!e.__esModule?p(n,"default",{value:e,enumerable:!0}):n,e)),P=e=>b(p({},"__esModule",{value:!0}),e);var X={};J(X,{activate:()=>V,deactivate:()=>U});module.exports=P(X);var o=N(require("vscode")),m,u="",x=!1,s;function v(e){m.text=`${x?"\u{1F535}":""} ${e}`}function l(e){let n=o.workspace.getConfiguration("findAndJump").get(e);if(n===void 0){let c=`Missing config value for ${e}`;throw w(c,"error"),new Error(c)}return n}var M={matches:o.window.createTextEditorDecorationType({backgroundColor:l("matchesColor.background"),color:l("matchesColor.foreground")}),currentMatch:o.window.createTextEditorDecorationType({backgroundColor:l("currentMatchColor.background"),color:l("currentMatchColor.foreground")})};function F(e,t){e.setDecorations(M.matches,t)}function w(e,t="default"){switch(t){case"default":{o.window.showInformationMessage(e);break}case"error":{o.window.showErrorMessage(e);break}default:throw new Error(`Unkown tooltip type: ${t}`)}}function T(){v("Search mode active")}function y(e){x=e,o.commands.executeCommand("setContext","findAndJump.isSearchModeActive",e)}function L(){m=o.window.createStatusBarItem(o.StatusBarAlignment.Left,100),m.command="findAndJump.exitSearchMode",m.tooltip="Click to exit search mode.",m.show(),v("Extension activated")}function A({matchIndex:e,searchTerm:t,document:n}){if(typeof e>"u")throw w("Something went wrong. See logs for more information. Error: Missing match index"),new Error("Missing match index");let c=n.positionAt(e),r=n.positionAt(e+t.length);return new o.Range(c,r)}function k(e,t){let n=o.window.activeTextEditor;if(n)if(s)n.setDecorations(M.currentMatch,[e]),n.selection=new o.Selection(e.start,e.end),n.revealRange(e,o.TextEditorRevealType.InCenterIfOutsideViewport),s.currentIndex=t;else throw new Error("No search context");else throw new Error("No active text editor")}function V(e){console.debug("Activated"),L();let t=o.commands.registerCommand("findAndJump.activateSearchMode",()=>{console.debug("Command: activateSearchMode"),x||(y(!0),T())}),n=o.commands.registerCommand("type",i=>{console.debug("Command: type"),x?(u+=i.text,I(u)):o.commands.executeCommand("default:type",i)}),c=o.commands.registerCommand("findAndJump.captureBackspace",()=>{console.debug("Command: captureBackspace"),x&&(u.length>0&&(u=u.slice(0,-1)),u.length>0?I(u):T())}),r=o.commands.registerCommand("findAndJump.exitSearchMode",()=>{console.debug("Command: exitSearchMode"),z()}),a=o.commands.registerCommand("findAndJump.cycleThroughMatches",()=>{console.debug("Command: cycleThroughMatches"),E("forwards")}),d=o.commands.registerCommand("findAndJump.cycleThroughMatchesBackwards",()=>{console.debug("Command: cycleThroughMatchesBackwards"),E("backwards")});e.subscriptions.push(m,t,n,a,d,c,r)}function _(e,t){let n=Number.MAX_SAFE_INTEGER,c=null;function r(a,d){c={...c,range:a,indexOfMatchDecorations:d}}return e.forEach((a,d)=>{let i=a.range;if(!c)r(i,d);else{let h=Math.abs(t.line-i.start.line);h<n&&(n=h,r(i,d))}}),c}function E(e="forwards"){if(!s)throw new Error("Missing search context");let t=e==="forwards"?1:-1,n=(s.currentIndex+t)%s.matches.length;s.currentIndex=n;let c=s.matches.at(s.currentIndex),r=o.window.activeTextEditor;if(r){let a=A({matchIndex:c,searchTerm:s.searchTerm,document:r.document});k(a,n)}else throw new Error("No active text editor")}function I(e){console.debug("######## Executing search for: ",e);let t=o.window.activeTextEditor;if(!t){w("No active text editor.","error");return}let c=t.document.getText(),a=!!l("caseSensitiveSearch")===!0?"g":"gi",d=new RegExp(e,a),i=Array.from(c.matchAll(d),g=>g.index),h=i.length,C=`Searching for: '${e}'`;if(h===0){s?.searchTerm&&(s.searchTerm=e),v(`${C} | No matches`),l("showTooltipIfNoMatches")&&w(`No matches found for ${e}.`);return}else v(`${C} | ${h} match${h===1?"":"es | Press TAB to cycle through"}`);let S=i.filter(g=>typeof g=="number").map(g=>({range:A({matchIndex:g,searchTerm:e,document:t.document})}));F(t,S);let f=_(S,t.selection.start);s={searchTerm:e,matches:i,currentIndex:f?f.indexOfMatchDecorations:0},f&&k(f.range,f.indexOfMatchDecorations),console.debug("######## End of executing search")}function z(){y(!1),G();let e="Exited search mode";console.debug(e),v(e)}function G(){u="",s=null;let e=o.window.activeTextEditor;if(e)e.setDecorations(M.matches,[]),e.setDecorations(M.currentMatch,[]);else throw new Error("No active text editor")}function U(){console.debug("Deactivated")}0&&(module.exports={activate,deactivate});
