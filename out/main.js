"use strict";var D=Object.create;var g=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var R=(e,o)=>{for(var n in o)g(e,n,{get:o[n],enumerable:!0})},b=(e,o,n,c)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of $(o))!N.call(e,r)&&r!==n&&g(e,r,{get:()=>o[r],enumerable:!(c=I(o,r))||c.enumerable});return e};var O=(e,o,n)=>(n=e!=null?D(J(e)):{},b(o||!e||!e.__esModule?g(n,"default",{value:e,enumerable:!0}):n,e)),P=e=>b(g({},"__esModule",{value:!0}),e);var q={};R(q,{activate:()=>L,deactivate:()=>j});module.exports=P(q);var t=O(require("vscode")),u,a="",l=!1,s;function f(e){u.text=`${l?"\u{1F535}":""} ${e}`}function m(e){let n=t.workspace.getConfiguration("findAndJump").get(e);if(n===void 0){let c=`Missing config value for ${e}`;throw v(c,"error"),new Error(c)}return n}var x={matches:t.window.createTextEditorDecorationType({backgroundColor:m("matchesColor.background"),color:m("matchesColor.foreground")}),currentMatch:t.window.createTextEditorDecorationType({backgroundColor:m("currentMatchColor.background"),color:m("currentMatchColor.foreground")})};function z(e,o){e.setDecorations(x.matches,o)}function v(e,o="default"){switch(o){case"default":{t.window.showInformationMessage(e);break}case"error":{t.window.showErrorMessage(e);break}default:throw new Error(`Unkown tooltip type: ${o}`)}}function T(){f("Search mode activate")}function y(e){l=e,t.commands.executeCommand("setContext","findAndJump.isSearchModeActive",e)}function F(){u=t.window.createStatusBarItem(t.StatusBarAlignment.Left,100),u.command="findAndJump.exitSearchMode",u.tooltip="Click to exit search mode.",u.show(),f("Extension activated")}function A({matchIndex:e,searchTerm:o,document:n}){if(typeof e>"u")throw v("Something went wrong. See logs for more information. Error: Missing match index"),new Error("Missing match index");let c=n.positionAt(e),r=n.positionAt(e+o.length);return new t.Range(c,r)}function B(e){let o=t.window.activeTextEditor;if(o)o.setDecorations(x.currentMatch,[e]),o.selection=new t.Selection(e.start,e.end),o.revealRange(e,t.TextEditorRevealType.InCenter);else throw new Error("No active text editor")}function L(e){console.debug("Activated"),F();let o=t.commands.registerCommand("findAndJump.activateSearchMode",()=>{console.debug("Command: activateSearchMode"),l||(y(!0),T())}),n=t.commands.registerCommand("type",d=>{console.debug("Command: type"),l?(a+=d.text,k(a)):t.commands.executeCommand("default:type",d)}),c=t.commands.registerCommand("findAndJump.captureBackspace",()=>{console.debug("Command: captureBackspace"),l&&(a.length>0&&(a=a.slice(0,-1)),a.length>0?k(a):T())}),r=t.commands.registerCommand("findAndJump.exitSearchMode",()=>{console.debug("Command: exitSearchMode"),U()}),i=t.commands.registerCommand("findAndJump.cycleThroughMatches",()=>{console.debug("Command: cycleThroughMatches"),E("forwards")}),w=t.commands.registerCommand("findAndJump.cycleThroughMatchesBackwards",()=>{console.debug("Command: cycleThroughMatchesBackwards"),E("backwards")});e.subscriptions.push(u,o,n,i,w,c,r)}function E(e="forwards"){if(!s)throw new Error("Missing search context");let o=e==="forwards"?1:-1,n=(s.currentIndex+o)%s.matches.length;s.currentIndex=n;let c=s.matches.at(s.currentIndex),r=t.window.activeTextEditor;if(r){let i=A({matchIndex:c,searchTerm:s.searchTerm,document:r.document});B(i)}else throw new Error("No active text editor")}function k(e){console.debug("######## Executing search for: ",e);let o=t.window.activeTextEditor;if(!o){v("No active text editor.","error");return}let c=o.document.getText(),i=!!m("caseSensitiveSearch")===!0?"g":"gi",w=new RegExp(e,i),d=Array.from(c.matchAll(w),h=>h.index),p=d.length,C=`Searching for: '${e}'`;if(p===0){s?.searchTerm&&(s.searchTerm=e),f(`${C} | No matches`),m("showTooltipIfNoMatches")&&v(`No matches found for ${e}.`);return}else f(`${C} | ${p} match${p===1?"":"es | Press TAB to cycle through"}`);let M=d.filter(h=>typeof h=="number").map(h=>({range:A({matchIndex:h,searchTerm:e,document:o.document})}));z(o,M);let S=M.at(0);S&&B(S.range),s={searchTerm:e,matches:d,currentIndex:0},console.debug("######## End of executing search")}function U(){y(!1),V();let e="Exited search mode";console.debug(e),f(e)}function V(){a="",s=null;let e=t.window.activeTextEditor;if(e)e.setDecorations(x.matches,[]),e.setDecorations(x.currentMatch,[]);else throw new Error("No active text editor")}function j(){console.debug("Deactivated")}0&&(module.exports={activate,deactivate});
