"use strict";var E=Object.create;var p=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var B=(e,o)=>{for(var n in o)p(e,n,{get:o[n],enumerable:!0})},w=(e,o,n,c)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of y(o))!I.call(e,s)&&s!==n&&p(e,s,{get:()=>o[s],enumerable:!(c=T(o,s))||c.enumerable});return e};var $=(e,o,n)=>(n=e!=null?E(A(e)):{},w(o||!e||!e.__esModule?p(n,"default",{value:e,enumerable:!0}):n,e)),k=e=>w(p({},"__esModule",{value:!0}),e);var H={};B(H,{activate:()=>R,deactivate:()=>z});module.exports=k(H);var t=$(require("vscode")),g,i="",f=!1,r;function l(e){g.text=`${f?"\u{1F535}":""} ${e}`}function D(e){let n=t.workspace.getConfiguration("findAndJump").get(e);if(n===void 0){let c=`Missing config value for ${e}`;throw v(c,"error"),new Error(c)}return n}var J=t.window.createTextEditorDecorationType({backgroundColor:{id:"myExtension.searchHighlight"}});function v(e,o="default"){switch(o){case"default":{t.window.showInformationMessage(e);break}case"error":{t.window.showErrorMessage(e);break}default:throw new Error(`Unkown tooltip type: ${o}`)}}function M(){l("Search mode activate")}function S(e){f=e,t.commands.executeCommand("setContext","findAndJump.isSearchModeActive",e)}function N(){g=t.window.createStatusBarItem(t.StatusBarAlignment.Left,100),g.command="findAndJump.exitSearchMode",g.tooltip="Click to exit search mode.",g.show(),l("Extension activated")}function b({matchIndex:e,searchTerm:o,document:n}){if(typeof e>"u")throw v("Something went wrong. See logs for more information. Error: Missing match index"),new Error("Missing match index");let c=n.positionAt(e),s=n.positionAt(e+o.length);return new t.Range(c,s)}function R(e){console.debug("Activated"),N();let o=t.commands.registerCommand("findAndJump.activateSearchMode",()=>{console.debug("Command: activateSearchMode"),f||(S(!0),M())}),n=t.commands.registerCommand("type",a=>{console.debug("Command: type"),f?(i+=a.text,C(i)):t.commands.executeCommand("default:type",a)}),c=t.commands.registerCommand("findAndJump.captureBackspace",()=>{console.debug("Command: captureBackspace"),f&&(i.length>0&&(i=i.slice(0,-1)),i.length>0?C(i):M())}),s=t.commands.registerCommand("findAndJump.exitSearchMode",()=>{console.debug("Command: exitSearchMode"),P()}),u=t.commands.registerCommand("findAndJump.cycleThroughMatches",()=>{if(console.debug("Command: cycleThroughMatches"),!r)throw new Error("Missing search context");let a=(r.currentIndex+1)%r.matches.length;r.currentIndex=a;let x=r.matches.at(r.currentIndex),d=t.window.activeTextEditor;if(d){let m=b({matchIndex:x,searchTerm:r.searchTerm,document:d.document});d.selection=new t.Selection(m.start,m.end),d.revealRange(m,t.TextEditorRevealType.InCenter)}else throw new Error("No active text editor")});e.subscriptions.push(g,o,n,u,c,s)}function C(e){console.debug("######## Executing search for: ",e);let o=t.window.activeTextEditor;if(!o){v("No active text editor.","error");return}let c=o.document.getText(),s=new RegExp(e,"g"),u=Array.from(c.matchAll(s),h=>h.index),a=u.length,x=`Searching for: '${e}'`;if(a===0){r?.searchTerm&&(r.searchTerm=e),l(`${x} | No matches`),D("showTooltipIfNoMatches")&&v(`No matches found for ${e}.`);return}else l(`${x} | ${a} match${a===1?"":"es | Press TAB to cycle through"}`);let d=u.filter(h=>typeof h=="number").map(h=>({range:b({matchIndex:h,searchTerm:e,document:o.document})})),m=d.at(0);m&&(o.selection=new t.Selection(m.range.start,m.range.end),o.setDecorations(J,d)),r={searchTerm:e,matches:u,currentIndex:0},console.debug("######## End of executing search")}function P(){S(!1),O();let e="Exited search mode";console.debug(e),l(e)}function O(){i="",r=null}function z(){console.debug("Deactivated")}0&&(module.exports={activate,deactivate});
