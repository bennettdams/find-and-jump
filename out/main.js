"use strict";var $=Object.create;var w=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var P=(e,o)=>{for(var t in o)w(e,t,{get:o[t],enumerable:!0})},b=(e,o,t,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let c of O(o))!J.call(e,c)&&c!==t&&w(e,c,{get:()=>o[c],enumerable:!(r=N(o,c))||r.enumerable});return e};var F=(e,o,t)=>(t=e!=null?$(R(e)):{},b(o||!e||!e.__esModule?w(t,"default",{value:e,enumerable:!0}):t,e)),L=e=>b(w({},"__esModule",{value:!0}),e);var q={};P(q,{activate:()=>z,deactivate:()=>j});module.exports=L(q);var n=F(require("vscode")),l,u="",x=!1,s;function f(e){l.text=`${x?"\u{1F535}":""} ${e}`}function m(e){let t=n.workspace.getConfiguration("findAndJump").get(e);if(t===void 0){let r=`Missing config value for ${e}`;throw p(r,"error"),new Error(r)}return t}var C={matches:n.window.createTextEditorDecorationType({backgroundColor:m("matchesColor.background"),color:m("matchesColor.foreground")}),currentMatch:n.window.createTextEditorDecorationType({backgroundColor:m("currentMatchColor.background"),color:m("currentMatchColor.foreground")})};function V(e,o){e.setDecorations(C.matches,o)}function p(e,o="default"){switch(o){case"default":{n.window.showInformationMessage(e);break}case"error":{n.window.showErrorMessage(e);break}default:{let t=o;throw new Error(`Unkown tooltip type: ${t}`)}}}function T(){f("Search mode active")}function A(e){x=e,n.commands.executeCommand("setContext","findAndJump.isSearchModeActive",e)}function _(){l=n.window.createStatusBarItem(n.StatusBarAlignment.Left,100),l.command="findAndJump.exitSearchMode",l.tooltip="Click to exit search mode.",l.show(),f("Extension activated")}function D({matchIndex:e,searchTerm:o,document:t}){if(typeof e>"u")throw p("Something went wrong. See logs for more information. Error: Missing match index"),new Error("Missing match index");let r=t.positionAt(e),c=t.positionAt(e+o.length);return new n.Range(r,c)}function I(e,o){let t=n.window.activeTextEditor;if(t)if(s)t.setDecorations(C.currentMatch,[e]),t.selection=new n.Selection(e.start,e.end),t.revealRange(e,n.TextEditorRevealType.InCenterIfOutsideViewport),s.currentIndex=o;else throw new Error("No search context");else throw new Error("No active text editor")}function z(e){console.debug("Activated"),_();let o=n.commands.registerCommand("findAndJump.activateSearchMode",()=>{console.debug("Command: activateSearchMode"),x||(A(!0),T())}),t=n.commands.registerCommand("type",h=>{console.debug("Command: type"),x?(u+=h.text,y(u)):n.commands.executeCommand("default:type",h)}),r=n.commands.registerCommand("findAndJump.captureBackspace",()=>{console.debug("Command: captureBackspace"),x&&(u.length>0&&(u=u.slice(0,-1)),u.length>0?y(u):T())}),c=n.commands.registerCommand("findAndJump.exitSearchMode",()=>{console.debug("Command: exitSearchMode"),U()}),a=n.commands.registerCommand("findAndJump.cycleThroughMatches",()=>{console.debug("Command: cycleThroughMatches"),k("forwards")}),i=n.commands.registerCommand("findAndJump.cycleThroughMatchesBackwards",()=>{console.debug("Command: cycleThroughMatchesBackwards"),k("backwards")});e.subscriptions.push(l,o,t,a,i,r,c)}function G(e,o){let t=Number.MAX_SAFE_INTEGER,r=null;function c(a,i){r={...r,range:a,indexOfMatchDecorations:i}}return e.forEach((a,i)=>{let h=a.range;if(!r)c(h,i);else{let v=Math.abs(o.line-h.start.line);v<t&&(t=v,c(h,i))}}),r}function k(e="forwards"){if(!s)throw new Error("Missing search context");let o=e==="forwards"?1:-1,t=(s.currentIndex+o)%s.matches.length;s.currentIndex=t;let r=s.matches.at(s.currentIndex),c=n.window.activeTextEditor;if(c){let a=D({matchIndex:r,searchTerm:s.searchTerm,document:c.document});I(a,t)}else throw new Error("No active text editor")}function y(e){console.debug("######## Executing search for: ",e);let o=`Searching for: '${e}'`,t=e.length,r=Number(m("minimumCharactersToExecuteSearch"));if(t<r){let d=r-t;f(`${o} | Enter ${d} more character${d>1?"s":""}.`);return}let c=n.window.activeTextEditor;if(!c){p("No active text editor.","error");return}let i=c.document.getText(),v=!!m("caseSensitiveSearch")===!0?"g":"gi",B=new RegExp(e,v),M=Array.from(i.matchAll(B),d=>d.index),E=M.length;if(E===0){s?.searchTerm&&(s.searchTerm=e),f(`${o} | No matches`),m("showTooltipIfNoMatches")&&p(`No matches found for ${e}.`);return}else f(`${o} | ${E} match${E===1?"":"es | Press TAB to cycle through"}`);let S=M.filter(d=>typeof d=="number").map(d=>({range:D({matchIndex:d,searchTerm:e,document:c.document})}));V(c,S);let g=G(S,c.selection.start);s={searchTerm:e,matches:M,currentIndex:g?g.indexOfMatchDecorations:0},g&&I(g.range,g.indexOfMatchDecorations),console.debug("######## End of executing search")}function U(){A(!1),X();let e="Exited search mode";console.debug(e),f(e)}function X(){u="",s=null;let e=n.window.activeTextEditor;if(e)e.setDecorations(C.matches,[]),e.setDecorations(C.currentMatch,[]);else throw new Error("No active text editor")}function j(){console.debug("Deactivated")}0&&(module.exports={activate,deactivate});
