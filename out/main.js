"use strict";var B=Object.create;var C=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var N=(e,t)=>{for(var o in t)C(e,o,{get:t[o],enumerable:!0})},T=(e,t,o,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of O(t))!J.call(e,r)&&r!==o&&C(e,r,{get:()=>t[r],enumerable:!(c=$(t,r))||c.enumerable});return e};var P=(e,t,o)=>(o=e!=null?B(R(e)):{},T(t||!e||!e.__esModule?C(o,"default",{value:e,enumerable:!0}):o,e)),F=e=>T(C({},"__esModule",{value:!0}),e);var j={};N(j,{activate:()=>_,deactivate:()=>X});module.exports=F(j);var n=P(require("vscode")),m,d="",x=!1,s;function l(e){m.text=`${x?"\u{1F535}":""} ${e}`}function h(e){let o=n.workspace.getConfiguration("findAndJump").get(e);if(o===void 0){let c=`Missing config value for ${e}`;throw M(c,"error"),new Error(c)}return o}var p={matches:n.window.createTextEditorDecorationType({backgroundColor:h("matchesColor.background"),color:h("matchesColor.foreground")}),currentMatch:n.window.createTextEditorDecorationType({backgroundColor:h("currentMatchColor.background"),color:h("currentMatchColor.foreground")})};function L(e,t){e.setDecorations(p.matches,t)}function M(e,t="default"){switch(t){case"default":{n.window.showInformationMessage(e);break}case"error":{n.window.showErrorMessage(e);break}default:throw new Error(`Unkown tooltip type: ${t}`)}}function E(){l("Search mode active")}function A(e){x=e,n.commands.executeCommand("setContext","findAndJump.isSearchModeActive",e)}function V(){m=n.window.createStatusBarItem(n.StatusBarAlignment.Left,100),m.command="findAndJump.exitSearchMode",m.tooltip="Click to exit search mode.",m.show(),l("Extension activated")}function k({matchIndex:e,searchTerm:t,document:o}){if(typeof e>"u")throw M("Something went wrong. See logs for more information. Error: Missing match index"),new Error("Missing match index");let c=o.positionAt(e),r=o.positionAt(e+t.length);return new n.Range(c,r)}function D(e,t){let o=n.window.activeTextEditor;if(o)if(s)o.setDecorations(p.currentMatch,[e]),o.selection=new n.Selection(e.start,e.end),o.revealRange(e,n.TextEditorRevealType.InCenterIfOutsideViewport),s.currentIndex=t;else throw new Error("No search context");else throw new Error("No active text editor")}function _(e){console.debug("Activated"),V();let t=n.commands.registerCommand("findAndJump.activateSearchMode",()=>{console.debug("Command: activateSearchMode"),x||(A(!0),E())}),o=n.commands.registerCommand("type",i=>{console.debug("Command: type"),x?(d+=i.text,y(d)):n.commands.executeCommand("default:type",i)}),c=n.commands.registerCommand("findAndJump.captureBackspace",()=>{console.debug("Command: captureBackspace"),x&&(d.length>0&&(d=d.slice(0,-1)),d.length>0?y(d):E())}),r=n.commands.registerCommand("findAndJump.exitSearchMode",()=>{console.debug("Command: exitSearchMode"),G()}),a=n.commands.registerCommand("findAndJump.cycleThroughMatches",()=>{console.debug("Command: cycleThroughMatches"),I("forwards")}),u=n.commands.registerCommand("findAndJump.cycleThroughMatchesBackwards",()=>{console.debug("Command: cycleThroughMatchesBackwards"),I("backwards")});e.subscriptions.push(m,t,o,a,u,c,r)}function z(e,t){let o=Number.MAX_SAFE_INTEGER,c=null;function r(a,u){c={...c,range:a,indexOfMatchDecorations:u}}return e.forEach((a,u)=>{let i=a.range;if(!c)r(i,u);else{let v=Math.abs(t.line-i.start.line);v<o&&(o=v,r(i,u))}}),c}function I(e="forwards"){if(!s)throw new Error("Missing search context");let t=e==="forwards"?1:-1,o=(s.currentIndex+t)%s.matches.length;s.currentIndex=o;let c=s.matches.at(s.currentIndex),r=n.window.activeTextEditor;if(r){let a=k({matchIndex:c,searchTerm:s.searchTerm,document:r.document});D(a,o)}else throw new Error("No active text editor")}function y(e){console.debug("######## Executing search for: ",e);let t=`Searching for: '${e}'`,o=Number(h("minimumCharactersToExecuteSearch"));if(e.length<o){l(`${t} | Enter ${o-e.length} more characters.`);return}let c=n.window.activeTextEditor;if(!c){M("No active text editor.","error");return}let a=c.document.getText(),i=!!h("caseSensitiveSearch")===!0?"g":"gi",v=new RegExp(e,i),w=Array.from(a.matchAll(v),g=>g.index),S=w.length;if(S===0){s?.searchTerm&&(s.searchTerm=e),l(`${t} | No matches`),h("showTooltipIfNoMatches")&&M(`No matches found for ${e}.`);return}else l(`${t} | ${S} match${S===1?"":"es | Press TAB to cycle through"}`);let b=w.filter(g=>typeof g=="number").map(g=>({range:k({matchIndex:g,searchTerm:e,document:c.document})}));L(c,b);let f=z(b,c.selection.start);s={searchTerm:e,matches:w,currentIndex:f?f.indexOfMatchDecorations:0},f&&D(f.range,f.indexOfMatchDecorations),console.debug("######## End of executing search")}function G(){A(!1),U();let e="Exited search mode";console.debug(e),l(e)}function U(){d="",s=null;let e=n.window.activeTextEditor;if(e)e.setDecorations(p.matches,[]),e.setDecorations(p.currentMatch,[]);else throw new Error("No active text editor")}function X(){console.debug("Deactivated")}0&&(module.exports={activate,deactivate});
