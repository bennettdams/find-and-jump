"use strict";var I=Object.create;var p=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var N=(e,t)=>{for(var n in t)p(e,n,{get:t[n],enumerable:!0})},E=(e,t,n,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of B(t))!J.call(e,s)&&s!==n&&p(e,s,{get:()=>t[s],enumerable:!(c=D(t,s))||c.enumerable});return e};var R=(e,t,n)=>(n=e!=null?I($(e)):{},E(t||!e||!e.__esModule?p(n,"default",{value:e,enumerable:!0}):n,e)),O=e=>E(p({},"__esModule",{value:!0}),e);var q={};N(q,{activate:()=>L,deactivate:()=>j});module.exports=O(q);var o=R(require("vscode")),u,a="",g=!1,r;function f(e){u.text=`${g?"\u{1F535}":""} ${e}`}function m(e){let n=o.workspace.getConfiguration("findAndJump").get(e);if(n===void 0){let c=`Missing config value for ${e}`;throw C(c,"error"),new Error(c)}return n}var w={matches:o.window.createTextEditorDecorationType({backgroundColor:m("matchesColor.background"),color:m("matchesColor.foreground")}),currentMatch:o.window.createTextEditorDecorationType({backgroundColor:m("currentMatchColor.background"),color:m("currentMatchColor.foreground")})};function P(e,t){e.setDecorations(w.matches,t)}function C(e,t="default"){switch(t){case"default":{o.window.showInformationMessage(e);break}case"error":{o.window.showErrorMessage(e);break}default:throw new Error(`Unkown tooltip type: ${t}`)}}function b(){f("Search mode activate")}function A(e){g=e,o.commands.executeCommand("setContext","findAndJump.isSearchModeActive",e)}function z(){u=o.window.createStatusBarItem(o.StatusBarAlignment.Left,100),u.command="findAndJump.exitSearchMode",u.tooltip="Click to exit search mode.",u.show(),f("Extension activated")}function y({matchIndex:e,searchTerm:t,document:n}){if(typeof e>"u")throw C("Something went wrong. See logs for more information. Error: Missing match index"),new Error("Missing match index");let c=n.positionAt(e),s=n.positionAt(e+t.length);return new o.Range(c,s)}function k(e){let t=o.window.activeTextEditor;if(t)t.setDecorations(w.currentMatch,[e]),t.selection=new o.Selection(e.start,e.end),t.revealRange(e,o.TextEditorRevealType.InCenter);else throw new Error("No active text editor")}function L(e){console.debug("Activated"),z();let t=o.commands.registerCommand("findAndJump.activateSearchMode",()=>{console.debug("Command: activateSearchMode"),g||(A(!0),b())}),n=o.commands.registerCommand("type",i=>{console.debug("Command: type"),g?(a+=i.text,T(a)):o.commands.executeCommand("default:type",i)}),c=o.commands.registerCommand("findAndJump.captureBackspace",()=>{console.debug("Command: captureBackspace"),g&&(a.length>0&&(a=a.slice(0,-1)),a.length>0?T(a):b())}),s=o.commands.registerCommand("findAndJump.exitSearchMode",()=>{console.debug("Command: exitSearchMode"),U()}),v=o.commands.registerCommand("findAndJump.cycleThroughMatches",()=>{if(console.debug("Command: cycleThroughMatches"),!r)throw new Error("Missing search context");let i=(r.currentIndex+1)%r.matches.length;r.currentIndex=i;let h=r.matches.at(r.currentIndex),d=o.window.activeTextEditor;if(d){let x=y({matchIndex:h,searchTerm:r.searchTerm,document:d.document});k(x)}else throw new Error("No active text editor")});e.subscriptions.push(u,t,n,v,c,s)}function T(e){console.debug("######## Executing search for: ",e);let t=o.window.activeTextEditor;if(!t){C("No active text editor.","error");return}let c=t.document.getText(),v=!!m("caseSensitiveSearch")===!0?"g":"gi",i=new RegExp(e,v),h=Array.from(c.matchAll(i),l=>l.index),d=h.length,x=`Searching for: '${e}'`;if(d===0){r?.searchTerm&&(r.searchTerm=e),f(`${x} | No matches`),m("showTooltipIfNoMatches")&&C(`No matches found for ${e}.`);return}else f(`${x} | ${d} match${d===1?"":"es | Press TAB to cycle through"}`);let M=h.filter(l=>typeof l=="number").map(l=>({range:y({matchIndex:l,searchTerm:e,document:t.document})}));P(t,M);let S=M.at(0);S&&k(S.range),r={searchTerm:e,matches:h,currentIndex:0},console.debug("######## End of executing search")}function U(){A(!1),V();let e="Exited search mode";console.debug(e),f(e)}function V(){a="",r=null;let e=o.window.activeTextEditor;if(e)e.setDecorations(w.matches,[]),e.setDecorations(w.currentMatch,[]);else throw new Error("No active text editor")}function j(){console.debug("Deactivated")}0&&(module.exports={activate,deactivate});
